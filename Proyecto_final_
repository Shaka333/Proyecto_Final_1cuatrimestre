import csv

class Cliente:
    def __init__(self, documento, nombres, apellidos, edad, nacionalidad, genero):
        self.documento = documento
        self.nombres = nombres
        self.apellidos = apellidos
        self.edad = edad
        self.nacionalidad = nacionalidad
        self.genero = genero

class Producto:
    def __init__(self, nombre, valor_unitario, cantidad):
        self.nombre = nombre
        self.valor_unitario = valor_unitario
        self.cantidad = cantidad
        self.precio_total = valor_unitario * cantidad

class ManejadorClientes:
    def __init__(self):
        self.clientes = {}
        self.productos_clientes = {}

    def agregar_cliente(self, cliente):
        if cliente.documento in self.clientes:
            return 'El cliente ya se encuentra registrado'
        self.clientes[cliente.documento] = cliente
        self.productos_clientes[cliente.documento] = []
        return 'Cliente agregado exitosamente'

    def agregar_producto(self, documento, producto):
        if documento not in self.clientes:
            return 'El cliente no se encuentra registrado'
        self.productos_clientes[documento].append(producto)
        return 'Producto agregado exitosamente'

    def guardar_csv(self):
        with open('clientes.csv', 'w', newline='') as cliente_csv:
            writer = csv.DictWriter(cliente_csv, fieldnames=['documento', 'nombres', 'apellidos', 'edad', 'nacionalidad', 'genero'])
            writer.writeheader()
            for cliente in self.clientes.values():
                writer.writerow(cliente.__dict__)

        with open('productos_por_cliente.csv', 'w', newline='') as productos_csv:
            writer = csv.writer(productos_csv)
            writer.writerow(['documento', 'nombre_producto', 'valor_unitario', 'cantidad', 'precio_total'])
            for documento, productos in self.productos_clientes.items():
                for producto in productos:
                    writer.writerow([documento, producto.nombre, producto.valor_unitario, producto.cantidad, producto.precio_total])
        return 'Datos guardados en archivos CSV.'

manejador = ManejadorClientes()

if __name__ == "__main__":
    while True:
        print("\nMenú")
        print("1. Ingresar información de cliente")
        print("2. Ingresar información de producto comprado por un cliente")
        print("3. Guardar datos en archivos CSV")
        print("4. Salir")

        opcion = input("Seleccione una opción: ")

        if opcion == '1':
            documento = input('Ingrese el documento de identidad del cliente: ')
            nombres = input("Ingrese el nombre del cliente: ")
            apellidos = input("Ingrese los apellidos del cliente: ")
            edad = input("Ingrese la edad del cliente: ")
            nacionalidad = input("Ingrese la nacionalidad del cliente: ")
            genero = input("Ingrese el género del cliente: ")
            cliente = Cliente(documento, nombres, apellidos, edad, nacionalidad, genero)
            mensaje = manejador.agregar_cliente(cliente)
            print(mensaje)
        elif opcion == '2':
            documento = input('Ingrese el documento de identidad del cliente: ')
            nombre_producto = input('Escribir nombre del producto: ')
            valor_unitario = float(input('Escribir valor unitario del producto: '))
            cantidad = int(input("Ingrese la cantidad del producto comprado: "))
            producto = Producto(nombre_producto, valor_unitario, cantidad)
            mensaje = manejador.agregar_producto(documento, producto)
            print(mensaje)
        elif opcion == '3':
            mensaje = manejador.guardar_csv()
            print(mensaje)
        elif opcion == '4':
            print("Saliendo del programa...")
            break
        else:
            print("Opción no válida. Por favor, seleccione una opción válida.")
